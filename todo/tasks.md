# 项目待办事项 (TODO)

### 已完成

- [x] **系统音量调节条**：音量菜单增加系统音量滑动条 + 应用音量滑动条
- [x] **歌词控件布局**：横/竖屏布局调整；歌词来源按钮移到播放页底部控制条
- [x] **歌词翻译显示切换**：新增“翻译显示/隐藏”开关并持久化
- [x] **字体粗度调节**：歌词字体粗细调节
- [x] **定位实时播放乐曲位置**：列表页“定位正在播放”按钮 + 当前播放项强调
- [x] **正在播放页：添加到歌单**：在播放页“更多”菜单加入“添加到歌单”
- [x] **快捷键（基础）**
  - Ctrl + ↑：应用音量 +5%
  - Ctrl + ↓：应用音量 -5%
  - F1：占位（切换全屏）；沉浸模式完成后再改为切换沉浸模式
- [x] **播放模式提示精简**：移除“播放模式：”前缀
- [x] **桌面歌词按钮位置**：移动到播放页底部控制条更靠左位置
- [x] **蓝牙切换后系统音量不同步**：已加入超时与监听重绑以降低概率；若仍复现，改为 Windows CoreAudio 原生读写（Rust bridge）
- [x] **确保关闭应用时关闭桌面歌词**：关闭窗口/退出时统一清理并销毁窗口
- [x] **支持读取文件夹内封面图**：专辑详情页优先 cover.jpg/cover.png
- [x] **读取专辑艺术家**：读取 AlbumArtist 并用于专辑/艺术家关联（需重建索引生效）
- [x] **支持数字排序**：列表按自然排序（如 2 < 10）
- [x] **首字母索引**：列表右侧索引栏快速跳转
- [x] **优化文件夹页**：树形结构显示
- [x] **保证窗口大小不超过显示器**：启动与调整大小时自动限制

### 最近完成

- 退出清理：关闭窗口/点击退出都会执行清理（含关闭桌面歌词、保存配置、注销热键）
- 正在播放页增强：新增“添加到歌单”入口
- 专辑详情页：优先读取文件夹 cover.jpg/cover.png（无则回退内嵌封面）
- 列表体验：自然排序 + 右侧首字母索引栏快速跳转
- 文件夹页：树形结构展示
- 窗口：尺寸自动限制不超过显示器

## 下一步建议（先做什么）

1. **沉浸模式（优先）**
   - 依赖：需要明确“沉浸”的定义（隐藏哪些控件、如何唤出/自动隐藏、是否影响全屏/标题栏）
   - 现状：F1 目前仅做全屏占位；沉浸模式完成后把 F1 改为切换沉浸
2. **修复 SMTC（最后或倒数第二）**
   - 难点：Rust + Windows API + Flutter 侧生命周期/初始化一致性排查；需要明确复现条件
3. **继续补齐列表体验**
   - 已完成：首字母索引/快捷跳转栏、数字排序；下一步建议加全局搜索栏

## 未完成（功能）

- [ ] **沉浸模式**：隐藏控制部件，仅显示歌名/歌手/专辑/封面/歌词
- [ ] **输出设备单独设置**：支持指定输出设备(DIRECT-output)
- [ ] **独占模式缓冲区大小**：支持调整独占模式缓冲区大小
- [ ] **优化艺术家详情页**：参考 Windows 媒体播放器（todo\Windows 媒体播放器）
- [ ] **迁移到 SQLite**
- [x] **支持播放 mka**：已加载 BASSWebM.dll
- [x] **快捷键悬浮提示**：快捷键操作显示短暂提示；音量菜单内快捷键也会显示气泡

## 未完成（Bug）

- [ ] **修复 SMTC (System Media Transport Controls)**：Windows 媒体通知/控制失效时的排查与修复
